<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Materi PKN Interaktif</title>
<style>
  body { font-family: Arial, sans-serif; padding: 20px; background-color: #f9f9f9; }
  h1 { text-align: center; margin-bottom: 20px; }
  input, select { padding: 8px; margin-bottom: 10px; font-size: 16px; width: 100%; }
  table { width: 100%; border-collapse: collapse; margin-top: 10px; }
  th, td { border: 1px solid #ccc; padding: 10px; text-align: left; cursor: pointer; }
  th { background-color: #4CAF50; color: white; }
  tr.penting { background-color: #fffae6; font-weight: bold; }
  .pagination { margin-top: 10px; text-align: center; }
  .pagination button { padding: 5px 10px; margin: 2px; }
  @media (max-width: 600px) { th, td { font-size: 14px; padding: 6px; } }
</style>
</head>
<body>

<h1>Materi PKN Interaktif</h1>

<select id="filterPenting">
  <option value="all">Semua Materi</option>
  <option value="ya">Hanya Penting</option>
  <option value="tidak">Hanya Tidak Penting</option>
</select>

<input type="text" id="search" placeholder="Cari materi atau deskripsi...">

<table id="pknTable">
  <thead>
    <tr>
      <th data-key="no" data-order="asc">No ▲</th>
      <th data-key="materi" data-order="asc">Materi ▲</th>
      <th>Deskripsi</th>
    </tr>
  </thead>
  <tbody></tbody>
</table>

<div class="pagination" id="pagination"></div>

<script>
const API_URL = "https://script.google.com/macros/s/AKfycbw51j8TmebDa4LGwm8Awgfg1lJYeI3VC07oKTIa4esB047Cj5MOscyX6if5Q2VAU6vg/exec"; // Ganti dengan URL web app GAS Anda
let allData = [];
let currentPage = 1;
const rowsPerPage = 10;
let sortKey = 'no';
let sortOrder = 'asc';

async function loadData() {
  try {
    const res = await fetch(API_URL);
    const data = await res.json();
    allData = data;
    applyFilters();
  } catch (error) {
    console.error("Gagal memuat data:", error);
  }
}

function displayData(data) {
  const tbody = document.querySelector("#pknTable tbody");
  tbody.innerHTML = "";

  const start = (currentPage - 1) * rowsPerPage;
  const paginatedData = data.slice(start, start + rowsPerPage);

  paginatedData.forEach(item => {
    const tr = document.createElement("tr");
    if(item.penting.toLowerCase() === "ya") tr.classList.add("penting");
    tr.innerHTML = `<td>${item.no}</td><td>${item.materi}</td><td>${item.deskripsi}</td>`;
    tbody.appendChild(tr);
  });

  renderPagination(data.length);
}

function applyFilters() {
  const keyword = document.getElementById("search").value.toLowerCase();
  const filterPenting = document.getElementById("filterPenting").value;

  let filtered = allData.filter(item =>
    item.materi.toLowerCase().includes(keyword) ||
    item.deskripsi.toLowerCase().includes(keyword)
  );

  if(filterPenting !== "all") {
    filtered = filtered.filter(item => item.penting.toLowerCase() === filterPenting);
  }

  filtered.sort((a, b) => {
    if(sortKey === 'no') return sortOrder === 'asc' ? a.no - b.no : b.no - a.no;
    const valA = a[sortKey].toLowerCase();
    const valB = b[sortKey].toLowerCase();
    if(valA < valB) return sortOrder === 'asc' ? -1 : 1;
    if(valA > valB) return sortOrder === 'asc' ? 1 : -1;
    return 0;
  });

  displayData(filtered);
}

function renderPagination(totalItems) {
  const totalPages = Math.ceil(totalItems / rowsPerPage);
  const pagination = document.getElementById("pagination");
  pagination.innerHTML = "";
  for(let i=1; i<=totalPages; i++) {
    const btn = document.createElement("button");
    btn.textContent = i;
    if(i === currentPage) btn.style.fontWeight = 'bold';
    btn.addEventListener("click", () => { currentPage = i; applyFilters(); });
    pagination.appendChild(btn);
  }
}

// Event listeners
document.getElementById("search").addEventListener("input", () => { currentPage=1; applyFilters(); });
document.getElementById("filterPenting").addEventListener("change", () => { currentPage=1; applyFilters(); });

document.querySelectorAll("#pknTable th[data-key]").forEach(th => {
  th.addEventListener("click", () => {
    const key = th.getAttribute("data-key");
    const order = th.getAttribute("data-order");
    sortKey = key;
    sortOrder = order === "asc" ? "desc" : "asc";
    th.setAttribute("data-order", sortOrder);
    th.textContent = `${th.textContent.split(' ')[0]} ${sortOrder === "asc" ? '▲' : '▼'}`;
    applyFilters();
  });
});

loadData();
</script>

</body>
</html>
